

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MyCovertChannel module &mdash; Covert Channel 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=8d563738"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="CovertChannelBase module" href="CovertChannelBase.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Covert Channel
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">Covert Channel</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="CovertChannelBase.html">CovertChannelBase module</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">MyCovertChannel module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#MyCovertChannel.MyCovertChannel"><code class="docutils literal notranslate"><span class="pre">MyCovertChannel</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#MyCovertChannel.MyCovertChannel.receive"><code class="docutils literal notranslate"><span class="pre">MyCovertChannel.receive()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#MyCovertChannel.MyCovertChannel.send"><code class="docutils literal notranslate"><span class="pre">MyCovertChannel.send()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#MyCovertChannel.calculate_payload_size"><code class="docutils literal notranslate"><span class="pre">calculate_payload_size()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#MyCovertChannel.coin_number_to_flip"><code class="docutils literal notranslate"><span class="pre">coin_number_to_flip()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#MyCovertChannel.get_chessboard_from_packet_size"><code class="docutils literal notranslate"><span class="pre">get_chessboard_from_packet_size()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#MyCovertChannel.get_negation_bits_from_packet_size"><code class="docutils literal notranslate"><span class="pre">get_negation_bits_from_packet_size()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#MyCovertChannel.number_of_ones_in_bit_representation"><code class="docutils literal notranslate"><span class="pre">number_of_ones_in_bit_representation()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#MyCovertChannel.turn_parameter_list_into_devils_numbers"><code class="docutils literal notranslate"><span class="pre">turn_parameter_list_into_devils_numbers()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#MyCovertChannel.xor_result_of_chessboard"><code class="docutils literal notranslate"><span class="pre">xor_result_of_chessboard()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#source-code">Source Code</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Covert Channel</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="modules.html">Covert Channel</a></li>
      <li class="breadcrumb-item active">MyCovertChannel module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/MyCovertChannel.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-MyCovertChannel">
<span id="mycovertchannel-module"></span><h1>MyCovertChannel module<a class="headerlink" href="#module-MyCovertChannel" title="Link to this heading"></a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="MyCovertChannel.MyCovertChannel">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">MyCovertChannel.</span></span><span class="sig-name descname"><span class="pre">MyCovertChannel</span></span><a class="reference internal" href="_modules/MyCovertChannel.html#MyCovertChannel"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#MyCovertChannel.MyCovertChannel" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="CovertChannelBase.html#CovertChannelBase.CovertChannelBase" title="CovertChannelBase.CovertChannelBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">CovertChannelBase</span></code></a></p>
<ul class="simple">
<li><p>You are not allowed to change the file name and class name.</p></li>
<li><p>You can edit the class in any way you want (e.g. adding helper functions); however, there must be a “send” and a “receive” function, the covert channel will be triggered by calling these functions.</p></li>
</ul>
<dl class="py method">
<dt class="sig sig-object py" id="MyCovertChannel.MyCovertChannel.receive">
<span class="sig-name descname"><span class="pre">receive</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">devils_number_one</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">devils_number_two</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log_file_name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/MyCovertChannel.html#MyCovertChannel.receive"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#MyCovertChannel.MyCovertChannel.receive" title="Link to this definition"></a></dt>
<dd><p>We create a handle_packet function to handle the incoming packets. We calculate the chessboard and negation bits from the packet size. We determine the coin to flip according to the chessboard and devils number. We calculate the number of ones in the bit representation of the coin to flip</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="MyCovertChannel.MyCovertChannel.send">
<span class="sig-name descname"><span class="pre">send</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">devils_number_one</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">devils_number_two</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_sleep_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_sleep_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log_file_name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/MyCovertChannel.html#MyCovertChannel.send"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#MyCovertChannel.MyCovertChannel.send" title="Link to this definition"></a></dt>
<dd><p>First we measure the start time, then we generate a random binary message with 16 bits. We send the message bit by bit by creating packets with the help of the calculate_payload_size function. We sleep for a random time between min_sleep_time and max_sleep_time after sending each packet. Finally, we measure the end time and print the elapsed time.</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="MyCovertChannel.calculate_payload_size">
<span class="sig-prename descclassname"><span class="pre">MyCovertChannel.</span></span><span class="sig-name descname"><span class="pre">calculate_payload_size</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message_bits</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">devils_numbers</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/MyCovertChannel.html#calculate_payload_size"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#MyCovertChannel.calculate_payload_size" title="Link to this definition"></a></dt>
<dd><p>Calculates the required payload size according to the given message bits and devils numbers</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="MyCovertChannel.coin_number_to_flip">
<span class="sig-prename descclassname"><span class="pre">MyCovertChannel.</span></span><span class="sig-name descname"><span class="pre">coin_number_to_flip</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">chessboard</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">devils_number</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/MyCovertChannel.html#coin_number_to_flip"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#MyCovertChannel.coin_number_to_flip" title="Link to this definition"></a></dt>
<dd><p>Determines the coin to flip according to the given chessboard and devils number</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="MyCovertChannel.get_chessboard_from_packet_size">
<span class="sig-prename descclassname"><span class="pre">MyCovertChannel.</span></span><span class="sig-name descname"><span class="pre">get_chessboard_from_packet_size</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">packet_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/MyCovertChannel.html#get_chessboard_from_packet_size"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#MyCovertChannel.get_chessboard_from_packet_size" title="Link to this definition"></a></dt>
<dd><p>Retrieves the chessboard information from the packet size</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="MyCovertChannel.get_negation_bits_from_packet_size">
<span class="sig-prename descclassname"><span class="pre">MyCovertChannel.</span></span><span class="sig-name descname"><span class="pre">get_negation_bits_from_packet_size</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">packet_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/MyCovertChannel.html#get_negation_bits_from_packet_size"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#MyCovertChannel.get_negation_bits_from_packet_size" title="Link to this definition"></a></dt>
<dd><p>Retrieves the negation bits from the packet size</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="MyCovertChannel.number_of_ones_in_bit_representation">
<span class="sig-prename descclassname"><span class="pre">MyCovertChannel.</span></span><span class="sig-name descname"><span class="pre">number_of_ones_in_bit_representation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/MyCovertChannel.html#number_of_ones_in_bit_representation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#MyCovertChannel.number_of_ones_in_bit_representation" title="Link to this definition"></a></dt>
<dd><p>Calculates the number of ones in the binary representation of the given value</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="MyCovertChannel.turn_parameter_list_into_devils_numbers">
<span class="sig-prename descclassname"><span class="pre">MyCovertChannel.</span></span><span class="sig-name descname"><span class="pre">turn_parameter_list_into_devils_numbers</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lst</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/MyCovertChannel.html#turn_parameter_list_into_devils_numbers"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#MyCovertChannel.turn_parameter_list_into_devils_numbers" title="Link to this definition"></a></dt>
<dd><p>Calculates the devils numbers according to the user input</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="MyCovertChannel.xor_result_of_chessboard">
<span class="sig-prename descclassname"><span class="pre">MyCovertChannel.</span></span><span class="sig-name descname"><span class="pre">xor_result_of_chessboard</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">chessboard</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/MyCovertChannel.html#xor_result_of_chessboard"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#MyCovertChannel.xor_result_of_chessboard" title="Link to this definition"></a></dt>
<dd><p>Calculates the total XOR result of the coins of the given chessboard</p>
</dd></dl>

<section id="source-code">
<h2>Source Code<a class="headerlink" href="#source-code" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="kn">from</span> <span class="nn">CovertChannelBase</span> <span class="kn">import</span> <span class="n">CovertChannelBase</span>
<span class="linenos">  2</span><span class="kn">from</span> <span class="nn">scapy.all</span> <span class="kn">import</span> <span class="n">IP</span><span class="p">,</span> <span class="n">TCP</span><span class="p">,</span> <span class="n">sniff</span>
<span class="linenos">  3</span><span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="linenos">  4</span><span class="kn">import</span> <span class="nn">time</span>
<span class="linenos">  5</span><span class="kn">import</span> <span class="nn">random</span>
<span class="linenos">  6</span><span class="kn">import</span> <span class="nn">string</span>
<span class="linenos">  7</span>
<span class="linenos">  8</span>
<span class="linenos">  9</span><span class="n">BIT_PER_PACKET</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># The number of bits we send in each packet</span>
<span class="linenos"> 10</span><span class="n">CHESSBOARD_SIZE</span> <span class="o">=</span> <span class="mi">8</span>
<span class="linenos"> 11</span><span class="n">MIN_PACKET_SIZE</span> <span class="o">=</span> <span class="mi">20</span> <span class="c1"># Minimum TCP packet which only includes TCP headers size is 20 </span>
<span class="linenos"> 12</span>
<span class="linenos"> 13</span><span class="c1"># The first CHESSBOARD_SIZE bits of the packet size is the chessboard, the following BIT_PER_PACKET bits are the negation bits</span>
<span class="linenos"> 14</span><span class="c1"># length of bit representation of packet size = CHESSBOARD_SIZE + BIT_PER_PACKET</span>
<span class="linenos"> 15</span>
<span class="linenos"> 16</span><span class="k">def</span> <span class="nf">number_of_ones_in_bit_representation</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="linenos"> 17</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 18</span><span class="sd">    Calculates the number of ones in the binary representation of the given value</span>
<span class="linenos"> 19</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 20</span>    <span class="n">number_of_ones</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 21</span>    <span class="n">digit</span> <span class="o">=</span> <span class="mi">1</span>
<span class="linenos"> 22</span>    <span class="k">while</span> <span class="n">digit</span> <span class="o">&lt;=</span> <span class="n">value</span><span class="p">:</span>
<span class="linenos"> 23</span>        <span class="k">if</span> <span class="n">value</span> <span class="o">&amp;</span> <span class="n">digit</span><span class="p">:</span>
<span class="linenos"> 24</span>            <span class="n">number_of_ones</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos"> 25</span>        <span class="n">digit</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span>
<span class="linenos"> 26</span>    <span class="k">return</span> <span class="n">number_of_ones</span>
<span class="linenos"> 27</span>
<span class="linenos"> 28</span><span class="k">def</span> <span class="nf">xor_result_of_chessboard</span><span class="p">(</span><span class="n">chessboard</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="linenos"> 29</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 30</span><span class="sd">    Calculates the total XOR result of the coins of the given chessboard</span>
<span class="linenos"> 31</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 32</span>    <span class="n">xor_result</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 33</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">CHESSBOARD_SIZE</span><span class="p">):</span>
<span class="linenos"> 34</span>        <span class="k">if</span> <span class="n">chessboard</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos"> 35</span>            <span class="n">xor_result</span> <span class="o">^=</span> <span class="n">i</span>
<span class="linenos"> 36</span>        <span class="n">chessboard</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span>
<span class="linenos"> 37</span>    <span class="k">return</span> <span class="n">xor_result</span>
<span class="linenos"> 38</span>
<span class="linenos"> 39</span><span class="k">def</span> <span class="nf">coin_number_to_flip</span><span class="p">(</span><span class="n">chessboard</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">devils_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="linenos"> 40</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 41</span><span class="sd">    Determines the coin to flip according to the given chessboard and devils number</span>
<span class="linenos"> 42</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 43</span>    <span class="n">xor_result</span> <span class="o">=</span> <span class="n">xor_result_of_chessboard</span><span class="p">(</span><span class="n">chessboard</span><span class="p">)</span>
<span class="linenos"> 44</span>    <span class="n">coin</span> <span class="o">=</span> <span class="n">xor_result</span> <span class="o">^</span> <span class="n">devils_number</span>
<span class="linenos"> 45</span>    <span class="k">return</span> <span class="n">coin</span>
<span class="linenos"> 46</span>
<span class="linenos"> 47</span><span class="k">def</span> <span class="nf">turn_parameter_list_into_devils_numbers</span><span class="p">(</span><span class="n">lst</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="linenos"> 48</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 49</span><span class="sd">    Calculates the devils numbers according to the user input</span>
<span class="linenos"> 50</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 51</span>    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 52</span>    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
<span class="linenos"> 53</span>        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span> <span class="o">%</span> <span class="mi">8</span><span class="p">)</span>
<span class="linenos"> 54</span>    <span class="k">return</span> <span class="n">result</span>
<span class="linenos"> 55</span>
<span class="linenos"> 56</span><span class="k">def</span> <span class="nf">calculate_payload_size</span><span class="p">(</span><span class="n">message_bits</span><span class="p">,</span> <span class="n">devils_numbers</span><span class="p">):</span>
<span class="linenos"> 57</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 58</span><span class="sd">    Calculates the required payload size according to the given message bits and devils numbers</span>
<span class="linenos"> 59</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 60</span>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">message_bits</span><span class="p">)</span> <span class="o">!=</span> <span class="n">BIT_PER_PACKET</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">devils_numbers</span><span class="p">)</span> <span class="o">!=</span> <span class="n">BIT_PER_PACKET</span><span class="p">:</span>
<span class="linenos"> 61</span>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The length of the message bits and parameters should be equal to BIT_PER_PACKET&quot;</span><span class="p">)</span>
<span class="linenos"> 62</span>    
<span class="linenos"> 63</span>    <span class="n">minimum_chessboard_size</span> <span class="o">=</span> <span class="n">MIN_PACKET_SIZE</span> <span class="o">//</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">BIT_PER_PACKET</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1"># Minimum packet size is 54</span>
<span class="linenos"> 64</span>    <span class="n">chessboard</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="n">minimum_chessboard_size</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">CHESSBOARD_SIZE</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="linenos"> 65</span>
<span class="linenos"> 66</span>    <span class="n">negation_bits</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 67</span>    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">BIT_PER_PACKET</span><span class="p">):</span>
<span class="linenos"> 68</span>        <span class="n">devils_number</span> <span class="o">=</span> <span class="n">devils_numbers</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
<span class="linenos"> 69</span>        <span class="n">message_bit</span> <span class="o">=</span> <span class="n">message_bits</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
<span class="linenos"> 70</span>
<span class="linenos"> 71</span>        <span class="n">coin_to_flip</span> <span class="o">=</span> <span class="n">coin_number_to_flip</span><span class="p">(</span><span class="n">chessboard</span><span class="p">,</span> <span class="n">devils_number</span><span class="p">)</span>
<span class="linenos"> 72</span>
<span class="linenos"> 73</span>        <span class="n">negation_bits</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span>
<span class="linenos"> 74</span>        <span class="k">if</span> <span class="n">number_of_ones_in_bit_representation</span><span class="p">(</span><span class="n">coin_to_flip</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">(</span><span class="n">message_bit</span><span class="p">):</span>
<span class="linenos"> 75</span>            <span class="n">negation_bits</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos"> 76</span>
<span class="linenos"> 77</span>    <span class="n">packet_size</span> <span class="o">=</span> <span class="n">chessboard</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">BIT_PER_PACKET</span><span class="p">)</span> <span class="o">+</span> <span class="n">negation_bits</span>
<span class="linenos"> 78</span>    <span class="n">payload_size</span> <span class="o">=</span> <span class="n">packet_size</span> <span class="o">-</span> <span class="n">MIN_PACKET_SIZE</span> <span class="c1"># 54 bytes for TCP, IP and LINK headers</span>
<span class="linenos"> 79</span>    <span class="k">return</span> <span class="n">payload_size</span>
<span class="linenos"> 80</span>
<span class="linenos"> 81</span><span class="k">def</span> <span class="nf">get_chessboard_from_packet_size</span><span class="p">(</span><span class="n">packet_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="linenos"> 82</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 83</span><span class="sd">    Retrieves the chessboard information from the packet size</span>
<span class="linenos"> 84</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 85</span>    <span class="k">return</span> <span class="n">packet_size</span> <span class="o">//</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">BIT_PER_PACKET</span><span class="p">)</span>
<span class="linenos"> 86</span>
<span class="linenos"> 87</span><span class="k">def</span> <span class="nf">get_negation_bits_from_packet_size</span><span class="p">(</span><span class="n">packet_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="linenos"> 88</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 89</span><span class="sd">    Retrieves the negation bits from the packet size</span>
<span class="linenos"> 90</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 91</span>    <span class="k">return</span> <span class="n">packet_size</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">BIT_PER_PACKET</span><span class="p">)</span>
<span class="linenos"> 92</span>
<span class="linenos"> 93</span>
<span class="linenos"> 94</span>
<span class="linenos"> 95</span><span class="k">class</span> <span class="nc">MyCovertChannel</span><span class="p">(</span><span class="n">CovertChannelBase</span><span class="p">):</span>
<span class="linenos"> 96</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 97</span><span class="sd">    - You are not allowed to change the file name and class name.</span>
<span class="linenos"> 98</span><span class="sd">    - You can edit the class in any way you want (e.g. adding helper functions); however, there must be a &quot;send&quot; and a &quot;receive&quot; function, the covert channel will be triggered by calling these functions.</span>
<span class="linenos"> 99</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">100</span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">101</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">102</span><span class="sd">        We initialize the received message, bit array and stop flag.</span>
<span class="linenos">103</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">104</span>        <span class="bp">self</span><span class="o">.</span><span class="n">received_message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="linenos">105</span>        <span class="bp">self</span><span class="o">.</span><span class="n">bit_array</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">106</span>        <span class="bp">self</span><span class="o">.</span><span class="n">stop_flag</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos">107</span>
<span class="linenos">108</span>    <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">devils_number_one</span><span class="p">,</span> <span class="n">devils_number_two</span><span class="p">,</span> <span class="n">min_sleep_time</span><span class="p">,</span> <span class="n">max_sleep_time</span><span class="p">,</span> <span class="n">log_file_name</span><span class="p">):</span>
<span class="linenos">109</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">110</span><span class="sd">        First we measure the start time, then we generate a random binary message with 16 bits. We send the message bit by bit by creating packets with the help of the calculate_payload_size function. We sleep for a random time between min_sleep_time and max_sleep_time after sending each packet. Finally, we measure the end time and print the elapsed time.</span>
<span class="linenos">111</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">112</span>        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="linenos">113</span>        <span class="nb">print</span><span class="p">(</span><span class="n">start_time</span><span class="p">)</span>
<span class="linenos">114</span>
<span class="linenos">115</span>        <span class="n">devils_numbers</span> <span class="o">=</span> <span class="n">turn_parameter_list_into_devils_numbers</span><span class="p">([</span><span class="n">devils_number_one</span><span class="p">,</span> <span class="n">devils_number_two</span><span class="p">])</span>
<span class="linenos">116</span>        <span class="n">binary_message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_random_binary_message_with_logging</span><span class="p">(</span><span class="n">log_file_name</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
<span class="linenos">117</span>        <span class="n">msg_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">binary_message</span><span class="p">)</span>
<span class="linenos">118</span>        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">119</span>        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">msg_len</span><span class="p">:</span>
<span class="linenos">120</span>            <span class="n">message_bits</span> <span class="o">=</span> <span class="n">binary_message</span><span class="p">[</span><span class="n">i</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">BIT_PER_PACKET</span><span class="p">]</span>
<span class="linenos">121</span>            <span class="n">i</span> <span class="o">+=</span> <span class="n">BIT_PER_PACKET</span>
<span class="linenos">122</span>            <span class="n">pkt</span> <span class="o">=</span> <span class="n">IP</span><span class="p">(</span><span class="n">dst</span> <span class="o">=</span> <span class="s2">&quot;172.18.0.3&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="n">TCP</span><span class="p">(</span><span class="n">dport</span> <span class="o">=</span> <span class="mi">8000</span><span class="p">)</span> 
<span class="linenos">123</span>            <span class="n">payload_size</span> <span class="o">=</span> <span class="n">calculate_payload_size</span><span class="p">(</span><span class="n">message_bits</span><span class="p">,</span> <span class="n">devils_numbers</span><span class="p">)</span>
<span class="linenos">124</span>            <span class="n">character_list</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">punctuation</span>
<span class="linenos">125</span>            <span class="n">payload</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">character_list</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">payload_size</span><span class="p">))</span>
<span class="linenos">126</span>            <span class="n">pkt</span> <span class="o">=</span> <span class="n">pkt</span> <span class="o">/</span> <span class="n">payload</span>
<span class="linenos">127</span>            <span class="n">CovertChannelBase</span><span class="p">()</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">pkt</span><span class="p">)</span>
<span class="linenos">128</span>            <span class="n">CovertChannelBase</span><span class="p">()</span><span class="o">.</span><span class="n">sleep_random_time_ms</span><span class="p">(</span><span class="n">min_sleep_time</span><span class="p">,</span><span class="n">max_sleep_time</span><span class="p">)</span>
<span class="linenos">129</span>        <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="linenos">130</span>        <span class="nb">print</span><span class="p">(</span><span class="n">end_time</span><span class="p">)</span>
<span class="linenos">131</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Time elapsed: &quot;</span><span class="p">,</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
<span class="linenos">132</span>
<span class="linenos">133</span>        
<span class="linenos">134</span>    <span class="k">def</span> <span class="nf">receive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">devils_number_one</span><span class="p">,</span> <span class="n">devils_number_two</span><span class="p">,</span> <span class="n">log_file_name</span><span class="p">):</span>
<span class="linenos">135</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">136</span><span class="sd">        We create a handle_packet function to handle the incoming packets. We calculate the chessboard and negation bits from the packet size. We determine the coin to flip according to the chessboard and devils number. We calculate the number of ones in the bit representation of the coin to flip</span>
<span class="linenos">137</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">138</span>
<span class="linenos">139</span>        <span class="n">devils_numbers</span> <span class="o">=</span> <span class="n">turn_parameter_list_into_devils_numbers</span><span class="p">([</span><span class="n">devils_number_one</span><span class="p">,</span> <span class="n">devils_number_two</span><span class="p">])</span>
<span class="linenos">140</span>        <span class="k">def</span> <span class="nf">handle_packet</span><span class="p">(</span><span class="n">packet</span><span class="p">):</span>
<span class="linenos">141</span>            <span class="n">tcp_packet</span> <span class="o">=</span> <span class="n">packet</span><span class="p">[</span><span class="n">TCP</span><span class="p">]</span>
<span class="linenos">142</span>            <span class="n">packet_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tcp_packet</span><span class="p">)</span>
<span class="linenos">143</span>            <span class="n">chessboard</span> <span class="o">=</span> <span class="n">get_chessboard_from_packet_size</span><span class="p">(</span><span class="n">packet_size</span><span class="p">)</span>
<span class="linenos">144</span>            <span class="n">negation_bits</span> <span class="o">=</span> <span class="n">get_negation_bits_from_packet_size</span><span class="p">(</span><span class="n">packet_size</span><span class="p">)</span>
<span class="linenos">145</span>            <span class="k">for</span> <span class="n">devils_number</span> <span class="ow">in</span> <span class="n">devils_numbers</span><span class="p">:</span>
<span class="linenos">146</span>                <span class="n">coin_to_flip</span> <span class="o">=</span> <span class="n">coin_number_to_flip</span><span class="p">(</span><span class="n">chessboard</span><span class="p">,</span> <span class="n">devils_number</span><span class="p">)</span>
<span class="linenos">147</span>                <span class="n">number_of_ones</span> <span class="o">=</span> <span class="n">number_of_ones_in_bit_representation</span><span class="p">(</span><span class="n">coin_to_flip</span><span class="p">)</span>
<span class="linenos">148</span>                <span class="n">negation_bit</span> <span class="o">=</span> <span class="n">negation_bits</span> <span class="o">//</span> <span class="mi">2</span>
<span class="linenos">149</span>                <span class="n">negation_bits</span> <span class="o">=</span> <span class="n">negation_bits</span> <span class="o">%</span> <span class="mi">2</span>
<span class="linenos">150</span>                <span class="n">negation_bits</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span>
<span class="linenos">151</span>                <span class="k">if</span> <span class="n">negation_bit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">152</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">bit_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">number_of_ones</span> <span class="o">%</span> <span class="mi">2</span><span class="p">))</span>
<span class="linenos">153</span>                <span class="k">else</span><span class="p">:</span>
<span class="linenos">154</span>                    <span class="k">if</span> <span class="n">number_of_ones</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">155</span>                        <span class="bp">self</span><span class="o">.</span><span class="n">bit_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">)</span>
<span class="linenos">156</span>                    <span class="k">else</span><span class="p">:</span>
<span class="linenos">157</span>                        <span class="bp">self</span><span class="o">.</span><span class="n">bit_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)</span>
<span class="linenos">158</span>
<span class="linenos">159</span>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_array</span><span class="p">)</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
<span class="linenos">160</span>                <span class="n">received_char</span> <span class="o">=</span> <span class="n">CovertChannelBase</span><span class="p">()</span><span class="o">.</span><span class="n">convert_eight_bits_to_character</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bit_array</span><span class="p">))</span>
<span class="linenos">161</span>                <span class="bp">self</span><span class="o">.</span><span class="n">received_message</span> <span class="o">+=</span> <span class="n">received_char</span>
<span class="linenos">162</span>                <span class="k">if</span> <span class="n">received_char</span> <span class="o">==</span> <span class="s2">&quot;.&quot;</span><span class="p">:</span>
<span class="linenos">163</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">stop_flag</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos">164</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">received_message</span><span class="p">,</span> <span class="n">log_file_name</span><span class="p">)</span>
<span class="linenos">165</span>                    <span class="k">return</span>
<span class="linenos">166</span>                <span class="bp">self</span><span class="o">.</span><span class="n">bit_array</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<span class="linenos">167</span>
<span class="linenos">168</span>        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_flag</span><span class="p">:</span>
<span class="linenos">169</span>            <span class="n">sniff</span><span class="p">(</span><span class="nb">filter</span><span class="o">=</span><span class="s2">&quot;tcp and port 8000&quot;</span><span class="p">,</span> <span class="n">prn</span><span class="o">=</span><span class="n">handle_packet</span><span class="p">,</span> <span class="n">stop_filter</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_flag</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="CovertChannelBase.html" class="btn btn-neutral float-left" title="CovertChannelBase module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, METU - Computer Engineering Department.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>